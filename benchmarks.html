<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Examples" href="examples/index.html" /><link rel="prev" title="API Docs" href="api.html" />

    <!-- Generated with Sphinx 7.1.2 and Furo 2023.07.26 -->
        <title>Benchmarks</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=36a5483c" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=6b2c8899" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: black;
  --color-brand-content: #024bb0;
  --color-foreground-muted: #808080;
  --color-highlight-on-target: inherit;
  --color-highlighted-background: #ffffcc;
  --color-sidebar-link-text: black;
  --color-sidebar-link-text--top-level: black;
  --color-link: #024bb0;
  --color-link--hover: #024bb0;
  --color-link-underline: transparent;
  --color-link-underline--hover: #024bb0;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #ffffff;
  --color-brand-content: #5192d2;
  --color-highlight-on-target: inherit;
  --color-highlighted-background: #333300;
  --color-sidebar-link-text: #ffffffcc;
  --color-sidebar-link-text--top-level: #ffffffcc;
  --color-link: #5192d2;
  --color-link--hover: #5192d2;
  --color-link-underline: transparent;
  --color-link-underline--hover: #5192d2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #ffffff;
  --color-brand-content: #5192d2;
  --color-highlight-on-target: inherit;
  --color-highlighted-background: #333300;
  --color-sidebar-link-text: #ffffffcc;
  --color-sidebar-link-text--top-level: #ffffffcc;
  --color-link: #5192d2;
  --color-link--hover: #5192d2;
  --color-link-underline: transparent;
  --color-link-underline--hover: #5192d2;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">msgspec</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="_static/msgspec-logo-light.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="_static/msgspec-logo-dark.svg" alt="Dark Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="why.html">Why msgspec?</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="supported-types.html">Supported Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="structs.html">Structs</a></li>
<li class="toctree-l1"><a class="reference internal" href="constraints.html">Constraints</a></li>
<li class="toctree-l1"><a class="reference internal" href="converters.html">Converters</a></li>
<li class="toctree-l1"><a class="reference internal" href="jsonschema.html">JSON Schema</a></li>
<li class="toctree-l1"><a class="reference internal" href="schema-evolution.html">Schema Evolution</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="extending.html">Extending</a></li>
<li class="toctree-l1"><a class="reference internal" href="inspect.html">Inspecting Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="perf-tips.html">Performance Tips</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="api.html">API Docs</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Benchmarks</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="examples/index.html">Examples</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Examples</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="examples/geojson.html">GeoJSON</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/asyncio-kv.html">Asyncio TCP Key-Value Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/conda-repodata.html">Conda Repodata</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/pyproject-toml.html">Parsing <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="benchmarks">
<h1>Benchmarks<a class="headerlink" href="#benchmarks" title="Permalink to this heading">#</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Benchmarks are <em>hard</em>.</p>
<p>Repeatedly calling the same function in a tight loop will lead to the
instruction cache staying hot and branches being highly predictable. That’s
not representative of real world access patterns. It’s also hard to write a
nonbiased benchmark. I wrote msgspec, naturally whatever benchmark I
publish it’s going to perform well in.</p>
<p>Even so, people like to see benchmarks. I’ve tried to be as nonbiased as I
can be, and the results hopefully indicate a few tradeoffs you make when
you choose different serialization formats. I encourage you to write your
own benchmarks before making these decisions.</p>
</div>
<section id="benchmark-encoding-decoding">
<span id="encoding-benchmark"></span><h2>Benchmark - Encoding/Decoding<a class="headerlink" href="#benchmark-encoding-decoding" title="Permalink to this heading">#</a></h2>
<p>Here we show a simple benchmark serializing some structured data. The data
we’re serializing has the following schema (defined here using <a class="reference internal" href="api.html#msgspec.Struct" title="msgspec.Struct"><code class="xref py py-obj docutils literal notranslate"><span class="pre">msgspec.Struct</span></code></a>
types):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">msgspec</span>

<span class="k">class</span> <span class="nc">File</span><span class="p">(</span><span class="n">msgspec</span><span class="o">.</span><span class="n">Struct</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;file&quot;</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">created_by</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">created_at</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span>
    <span class="n">updated_at</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span>
    <span class="n">nbytes</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">class</span> <span class="nc">Directory</span><span class="p">(</span><span class="n">msgspec</span><span class="o">.</span><span class="n">Struct</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;directory&quot;</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">created_by</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">created_at</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span>
    <span class="n">updated_at</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span>
    <span class="n">contents</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">File</span> <span class="o">|</span> <span class="n">Directory</span><span class="p">]</span>
</pre></div>
</div>
<p>The libraries we’re benchmarking are the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ujson</span></code> (<a class="reference external" href="https://github.com/ultrajson/ultrajson">link</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">orjson</span></code> (<a class="reference external" href="https://github.com/ijl/orjson">link</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">msgpack</span></code> (<a class="reference external" href="https://github.com/msgpack/msgpack-python">link</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">msgspec.msgpack</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">msgspec.json</span></code></p></li>
</ul>
<p>Each benchmark creates a message containing one or more <code class="docutils literal notranslate"><span class="pre">File</span></code>/<code class="docutils literal notranslate"><span class="pre">Directory</span></code>
instances, then then serializes and deserializes it in a loop.</p>
<p>The full benchmark source can be found
<a class="reference external" href="https://github.com/jcrist/msgspec/tree/main/benchmarks/bench_encodings.py">here</a>.</p>
<section id="object">
<h3>1 Object<a class="headerlink" href="#object" title="Permalink to this heading">#</a></h3>
<p>Some workflows involve sending around very small messages. Here the overhead
per function call dominates (parsing of options, allocating temporary buffers,
etc…).</p>
<div id="bench-1" style="width:75%"></div><p>From the chart above, you can see that <code class="docutils literal notranslate"><span class="pre">msgspec.msgpack</span></code> and <code class="docutils literal notranslate"><span class="pre">msgspec.json</span></code>
performed quite well, encoding/decoding faster than all other options, even
those implementing the same serialization protocol. This is partly due to the
use of <code class="xref py py-obj docutils literal notranslate"><span class="pre">Struct</span></code> types here - since all keys are statically known, the msgspec
decoders can apply a few optimizations not available to other Python libraries
that rely on <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.11)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dict</span></code></a> types instead.</p>
<p>That said, all of these methods serialize/deserialize pretty quickly relative
to other python operations, so unless you’re counting every microsecond your
choice here probably doesn’t matter that much.</p>
</section>
<section id="objects">
<h3>1000 Objects<a class="headerlink" href="#objects" title="Permalink to this heading">#</a></h3>
<p>Here we serialize a tree of 1000 <code class="docutils literal notranslate"><span class="pre">File</span></code>/<code class="docutils literal notranslate"><span class="pre">Directory</span></code> objects. There’s a lot
more data here, so the per-call overhead will no longer dominate, and we’re now
measuring the efficiency of the encoding/decoding.</p>
<div id="bench-1k" style="width:75%"></div></section>
</section>
<section id="benchmark-schema-validation">
<h2>Benchmark - Schema Validation<a class="headerlink" href="#benchmark-schema-validation" title="Permalink to this heading">#</a></h2>
<p>The above benchmarks aren’t 100% fair to <code class="docutils literal notranslate"><span class="pre">msgspec</span></code>, as it also performs
schema validation on deserialization, checking that the message matches the
specified schema. None of the other options benchmarked support this natively.
Instead, many users perform validation post deserialization using additional
tools like <a class="reference external" href="https://pydantic-docs.helpmanual.io/">pydantic</a>.</p>
<p>Here we benchmark the following validation libraries, measuring JSON encoding
and decoding time.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://jcristharif.com/msgspec/">msgspec</a></p></li>
<li><p><a class="reference external" href="https://pydantic-docs.helpmanual.io/">pydantic</a></p></li>
<li><p><a class="reference external" href="https://catt.rs/en/latest/">cattrs</a></p></li>
<li><p><a class="reference external" href="https://github.com/Fatal1ty/mashumaro">mashumaro</a></p></li>
</ul>
<p>The full benchmark source can be found
<a class="reference external" href="https://github.com/jcrist/msgspec/tree/main/benchmarks/bench_validation.py">here</a>.</p>
<div id="bench-1k-validate" style="width:75%"></div><p>This plot shows the performance benefit of performing type validation during
message decoding (as done by <code class="docutils literal notranslate"><span class="pre">msgspec</span></code>) rather than as a secondary step with
a third-party library like <a class="reference external" href="https://pydantic-docs.helpmanual.io/">pydantic</a>. In this benchmark <code class="docutils literal notranslate"><span class="pre">msgspec</span></code> is ~10x
faster than <code class="docutils literal notranslate"><span class="pre">mashumaro</span></code>, ~12x faster than <code class="docutils literal notranslate"><span class="pre">cattrs</span></code>, and ~80x faster than
<code class="docutils literal notranslate"><span class="pre">pydantic</span></code>.</p>
<p>Validating after decoding is slower for two reasons:</p>
<ul class="simple">
<li><p>It requires traversing over the entire output structure a second time (which
can be slow due to pointer chasing)</p></li>
<li><p>It may require converting some python objects to their desired output types
(e.g. converting a decoded <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.11)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dict</span></code></a> to a <a class="reference external" href="https://pydantic-docs.helpmanual.io/">pydantic</a> model), resulting in
allocating many temporary python objects.</p></li>
</ul>
<p>In contrast, libraries like <code class="docutils literal notranslate"><span class="pre">msgspec</span></code> that validate during decoding have none
of these issues. Only a single pass over the decoded data is taken, and the
specified output types are created correctly the first time, avoiding the need
for additional unnecessary allocations.</p>
</section>
<section id="benchmark-memory-usage">
<span id="memory-benchmark"></span><h2>Benchmark - Memory Usage<a class="headerlink" href="#benchmark-memory-usage" title="Permalink to this heading">#</a></h2>
<p>Here we benchmark loading a <a class="reference external" href="https://conda.anaconda.org/conda-forge/noarch/repodata.json">medium-sized JSON file</a> (~65 MiB)
containing information on all the <code class="docutils literal notranslate"><span class="pre">noarch</span></code> packages in <a class="reference external" href="https://conda-forge.org/">conda-forge</a>. We
compare the following libraries:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://jcristharif.com/msgspec/">msgspec</a> with <code class="docutils literal notranslate"><span class="pre">msgspec.Struct</span></code> schemas pre-defined</p></li>
<li><p><a class="reference external" href="https://jcristharif.com/msgspec/">msgspec</a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/json.html">json</a></p></li>
<li><p><a class="reference external" href="https://github.com/ultrajson/ultrajson">ujson</a></p></li>
<li><p><a class="reference external" href="https://github.com/ijl/orjson">orjson</a></p></li>
<li><p><a class="reference external" href="https://github.com/TkTech/pysimdjson">simdjson</a></p></li>
</ul>
<p>For each library, we measure both the peak increase in memory usage (RSS) and
the time to JSON decode the file.</p>
<p>The full benchmark source can be found <a class="reference external" href="https://github.com/jcrist/msgspec/tree/main/benchmarks/bench_memory.py">here</a>.</p>
<p><strong>Results (smaller is better):</strong></p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>memory (MiB)</p></th>
<th class="head"><p>vs.</p></th>
<th class="head"><p>time (ms)</p></th>
<th class="head"><p>vs.</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>msgspec structs</strong></p></td>
<td><p>83.6</p></td>
<td><p>1.0x</p></td>
<td><p>170.6</p></td>
<td><p>1.0x</p></td>
</tr>
<tr class="row-odd"><td><p><strong>msgspec</strong></p></td>
<td><p>145.3</p></td>
<td><p>1.7x</p></td>
<td><p>383.1</p></td>
<td><p>2.2x</p></td>
</tr>
<tr class="row-even"><td><p><strong>json</strong></p></td>
<td><p>213.5</p></td>
<td><p>2.6x</p></td>
<td><p>526.4</p></td>
<td><p>3.1x</p></td>
</tr>
<tr class="row-odd"><td><p><strong>ujson</strong></p></td>
<td><p>230.6</p></td>
<td><p>2.8x</p></td>
<td><p>666.8</p></td>
<td><p>3.9x</p></td>
</tr>
<tr class="row-even"><td><p><strong>orjson</strong></p></td>
<td><p>263.9</p></td>
<td><p>3.2x</p></td>
<td><p>410.0</p></td>
<td><p>2.4x</p></td>
</tr>
<tr class="row-odd"><td><p><strong>simdjson</strong></p></td>
<td><p>403.7</p></td>
<td><p>4.8x</p></td>
<td><p>615.1</p></td>
<td><p>3.6x</p></td>
</tr>
</tbody>
</table>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">msgspec</span></code> decoding into <a class="reference internal" href="structs.html"><span class="doc">Struct</span></a> types uses the least amount of
memory, and is also the fastest to decode. This makes sense; <code class="docutils literal notranslate"><span class="pre">Struct</span></code> types
are cheaper to allocate and more memory efficient than <code class="docutils literal notranslate"><span class="pre">dict</span></code> types, and for
large messages these differences can really add up.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">msgspec</span></code> decoding without a schema is the second best option for both
memory usage and speed. When decoding without a schema, <code class="docutils literal notranslate"><span class="pre">msgspec</span></code> makes the
assumption that the underlying message probably still has some structure;
short dict keys are temporarily cached to be reused later on, rather than
reallocated every time. This means that instead of allocating 10,000 copies
of the string <code class="docutils literal notranslate"><span class="pre">&quot;name&quot;</span></code>, only a single copy is allocated and reused. For
large messages this can lead to significant memory savings. <code class="docutils literal notranslate"><span class="pre">json</span></code> and
<code class="docutils literal notranslate"><span class="pre">orjson</span></code> also use similar optimizations, but not as effectively.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">orjson</span></code> and <code class="docutils literal notranslate"><span class="pre">simdjson</span></code> use 3-5x more memory than <code class="docutils literal notranslate"><span class="pre">msgspec</span></code> in this
benchmark. In addition to the reasons above, both of these decoders require
copying the original message into a temporary buffer. In this case, the extra
copy adds an extra 65 MiB of overhead!</p></li>
</ul>
</section>
<section id="benchmark-structs">
<span id="struct-benchmark"></span><h2>Benchmark - Structs<a class="headerlink" href="#benchmark-structs" title="Permalink to this heading">#</a></h2>
<p>Here we benchmark common <a class="reference internal" href="api.html#msgspec.Struct" title="msgspec.Struct"><code class="xref py py-obj docutils literal notranslate"><span class="pre">msgspec.Struct</span></code></a> operations, comparing their
performance against other similar libraries. The cases compared are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">msgspec</span></code></p></li>
<li><p>Standard Python classes</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/dataclasses.html">dataclasses</a></p></li>
<li><p><a class="reference external" href="https://www.attrs.org">attrs</a></p></li>
<li><p><a class="reference external" href="https://pydantic-docs.helpmanual.io/">pydantic</a></p></li>
</ul>
<p>For each library, the following operations are benchmarked:</p>
<ul class="simple">
<li><p>Time to define a new class. Many libraries that abstract away class
boilerplate add overhead when defining classes, slowing import times for
libraries that make use of these classes.</p></li>
<li><p>Time to create an instance of that class.</p></li>
<li><p>Time to compare two instances for equality (<code class="docutils literal notranslate"><span class="pre">==</span></code>/<code class="docutils literal notranslate"><span class="pre">!=</span></code>).</p></li>
<li><p>Time to compare two instances for order (<code class="docutils literal notranslate"><span class="pre">&lt;</span></code>/<code class="docutils literal notranslate"><span class="pre">&gt;</span></code>/<code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>/<code class="docutils literal notranslate"><span class="pre">&gt;=</span></code>)</p></li>
</ul>
<p>The full benchmark source can be found <a class="reference external" href="https://github.com/jcrist/msgspec/tree/main/benchmarks/bench_structs.py">here</a>.</p>
<p><strong>Results (smaller is better):</strong></p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>import (μs)</p></th>
<th class="head"><p>create (μs)</p></th>
<th class="head"><p>equality (μs)</p></th>
<th class="head"><p>order (μs)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>msgspec</strong></p></td>
<td><p>9.92</p></td>
<td><p>0.09</p></td>
<td><p>0.02</p></td>
<td><p>0.03</p></td>
</tr>
<tr class="row-odd"><td><p><strong>standard classes</strong></p></td>
<td><p>6.86</p></td>
<td><p>0.45</p></td>
<td><p>0.13</p></td>
<td><p>0.29</p></td>
</tr>
<tr class="row-even"><td><p><strong>dataclasses</strong></p></td>
<td><p>489.07</p></td>
<td><p>0.47</p></td>
<td><p>0.27</p></td>
<td><p>0.30</p></td>
</tr>
<tr class="row-odd"><td><p><strong>attrs</strong></p></td>
<td><p>428.38</p></td>
<td><p>0.42</p></td>
<td><p>0.29</p></td>
<td><p>2.15</p></td>
</tr>
<tr class="row-even"><td><p><strong>pydantic</strong></p></td>
<td><p>371.52</p></td>
<td><p>4.84</p></td>
<td><p>10.56</p></td>
<td><p>N/A</p></td>
</tr>
</tbody>
</table>
</div>
<ul class="simple">
<li><p>Standard Python classes are the fastest to import (any library can only add
overhead here). Still, <code class="docutils literal notranslate"><span class="pre">msgspec</span></code> isn’t <em>that</em> much slower, especially
compared to other options.</p></li>
<li><p>Structs are optimized to be cheap to create, and that shows for the creation
benchmark. They’re roughly 5x faster than standard
classes/<code class="docutils literal notranslate"><span class="pre">attrs</span></code>/<code class="docutils literal notranslate"><span class="pre">dataclasses</span></code>, and 50x faster than <code class="docutils literal notranslate"><span class="pre">pydantic</span></code>.</p></li>
<li><p>For equality comparison, msgspec Structs are roughly 6x to 500x faster than
the alternatives.</p></li>
<li><p>For order comparison, msgspec Structs are roughly 10x to 70x faster than the
alternatives.</p></li>
</ul>
</section>
<section id="benchmark-garbage-collection">
<span id="struct-gc-benchmark"></span><h2>Benchmark - Garbage Collection<a class="headerlink" href="#benchmark-garbage-collection" title="Permalink to this heading">#</a></h2>
<p><a class="reference internal" href="api.html#msgspec.Struct" title="msgspec.Struct"><code class="xref py py-obj docutils literal notranslate"><span class="pre">msgspec.Struct</span></code></a> instances implement several optimizations for reducing garbage
collection (GC) pressure and decreasing memory usage. Here we benchmark structs
(with and without <a class="reference internal" href="structs.html#struct-gc"><span class="std std-ref">gc=False</span></a>) against standard Python
classes (with and without <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#slots">__slots__</a>).</p>
<p>For each option we create a large dictionary containing many simple instances
of the benchmarked type, then measure:</p>
<ul class="simple">
<li><p>The amount of time it takes to do a full garbage collection (gc) pass</p></li>
<li><p>The total amount of memory used by this data structure</p></li>
</ul>
<p>The full benchmark source can be found <a class="reference external" href="https://github.com/jcrist/msgspec/tree/main/benchmarks/bench_gc.py">here</a>.</p>
<p><strong>Results (smaller is better):</strong></p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>GC time (ms)</p></th>
<th class="head"><p>Memory Used (MiB)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>standard class</strong></p></td>
<td><p>80.46</p></td>
<td><p>211.66</p></td>
</tr>
<tr class="row-odd"><td><p><strong>standard class with __slots__</strong></p></td>
<td><p>80.06</p></td>
<td><p>120.11</p></td>
</tr>
<tr class="row-even"><td><p><strong>msgspec struct</strong></p></td>
<td><p>13.96</p></td>
<td><p>120.11</p></td>
</tr>
<tr class="row-odd"><td><p><strong>msgspec struct with gc=False</strong></p></td>
<td><p>1.07</p></td>
<td><p>104.85</p></td>
</tr>
</tbody>
</table>
</div>
<ul class="simple">
<li><p>Standard Python classes are the most memory hungry (since all data is stored
in an instance dict). They also result in the largest GC pause, as the GC has
to traverse the entire outer dict, each class instance, and each instance
dict. All that pointer chasing has a cost.</p></li>
<li><p>Standard classes with <code class="docutils literal notranslate"><span class="pre">__slots__</span></code> are less memory hungry, but still results
in an equivalent GC pauses.</p></li>
<li><p><a class="reference internal" href="api.html#msgspec.Struct" title="msgspec.Struct"><code class="xref py py-obj docutils literal notranslate"><span class="pre">msgspec.Struct</span></code></a> instances have the same memory layout as a class with
<code class="docutils literal notranslate"><span class="pre">__slots__</span></code> (and thus have the same memory usage), but due to deferred GC
tracking a full GC pass completes in a fraction of the time.</p></li>
<li><p><a class="reference internal" href="api.html#msgspec.Struct" title="msgspec.Struct"><code class="xref py py-obj docutils literal notranslate"><span class="pre">msgspec.Struct</span></code></a> instances with <code class="docutils literal notranslate"><span class="pre">gc=False</span></code> have the lowest memory usage
(lack of GC reduces memory by 16 bytes per instance). They also have the
lowest GC pause (75x faster than standard classes!) since the entire
composing dict can be skipped during GC traversal.</p></li>
</ul>
</section>
<section id="benchmark-library-size">
<span id="id1"></span><h2>Benchmark - Library Size<a class="headerlink" href="#benchmark-library-size" title="Permalink to this heading">#</a></h2>
<p>Here we compare the on-disk size of a few Python libraries.</p>
<p>The full benchmark source can be found <a class="reference external" href="https://github.com/jcrist/msgspec/tree/main/benchmarks/bench_library_size.py">here</a>.</p>
<p><strong>Results (smaller is better)</strong></p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>version</p></th>
<th class="head"><p>size (MiB)</p></th>
<th class="head"><p>vs. msgspec</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>msgspec</strong></p></td>
<td><p>0.12.0</p></td>
<td><p>0.34</p></td>
<td><p>1.00x</p></td>
</tr>
<tr class="row-odd"><td><p><strong>orjson</strong></p></td>
<td><p>3.8.5</p></td>
<td><p>0.56</p></td>
<td><p>1.64x</p></td>
</tr>
<tr class="row-even"><td><p><strong>msgpack</strong></p></td>
<td><p>1.0.4</p></td>
<td><p>0.99</p></td>
<td><p>2.91x</p></td>
</tr>
<tr class="row-odd"><td><p><strong>pydantic</strong></p></td>
<td><p>1.10.4</p></td>
<td><p>8.71</p></td>
<td><p>25.67x</p></td>
</tr>
</tbody>
</table>
</div>
<p>The functionality available in <code class="docutils literal notranslate"><span class="pre">msgspec</span></code> is comparable to that of <a class="reference external" href="https://github.com/ijl/orjson">orjson</a>,
<a class="reference external" href="https://github.com/msgpack/msgpack-python">msgpack</a>, and <a class="reference external" href="https://pydantic-docs.helpmanual.io/">pydantic</a> combined. However, the total installed binary size of
<code class="docutils literal notranslate"><span class="pre">msgspec</span></code> is a fraction of that of any of these libraries.</p>
<script src="https://cdn.jsdelivr.net/npm/vega@5.22.1"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-lite@5.5.0"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-embed@6.21.0"></script><script type="text/javascript">

function buildPlot(div, rows, title) {
    var i, time_unit, scale, max_time = 0;
    for (i = 0; i < rows.length; i++) {
        var total = rows[i][1] + rows[i][2];
        if (total > max_time) {
            max_time = total;
        }
    }
    if (max_time < 1e-6) {
        time_unit = "ns";
        scale = 1e9;
    }
    else if (max_time < 1e-3) {
        time_unit = "μs";
        scale = 1e6;
    }
    else {
        time_unit = "ms";
        scale = 1e3;
    }

    var columns = ["encode", "decode", "total"];
    var data = [];
    for (i = 0; i < rows.length; i++) {
        var lib = rows[i][0];
        var et = rows[i][1] * scale;
        var dt = rows[i][2] * scale;
        var tt = et + dt;
        data.push({library: lib, method: "encode", time: et});
        data.push({library: lib, method: "decode", time: dt});
        data.push({library: lib, method: "total", time: tt});
    }

    var spec = {
        "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json",
        "title": title,
        "config": {
            "view": {"stroke": null},
            "legend": {"title": null, "labelFontSize": 12},
            "title": {"fontSize": 14, "offset": 10},
            "axis": {"titleFontSize": 12, "titlePadding": 10}
        },
        "width": "container",
        "data": {"values": data},
        "transform": [
            {
                "calculate": `join([format(datum.time, '.3'), ' ${time_unit}'], '')`,
                "as": "tooltip",
            }
        ],
        "mark": "bar",
        "encoding": {
            "color": {
                "field": "method",
                "type": "nominal",
                "scale": {"scheme": "tableau20"},
                "sort": columns,
            },
            "row": {
                "field": "library",
                "header": {
                    "labelExpr": "split(datum.label, ' ')",
                    "orient": "left",
                    "labelAngle": 0,
                    "labelAlign": "left",
                    "labelFontSize": 12
                },
                "sort": {"field": "time", "op": "sum", "order": "ascending"},
                "title": null,
                "type": "nominal",
            },
            "tooltip": {"field": "tooltip", "type": "nominal"},
            "x": {
                "axis": {"grid": false, "title": `Time (${time_unit})`},
                "field": "time",
                "type": "quantitative",
            },
            "y": {
                "axis": {"labels": false, "ticks": false, "title": null},
                "field": "method",
                "type": "nominal",
                "sort": columns,
            },
        },
    };
    vegaEmbed(div, spec);
}

var results = {"1": [["ujson", 8.829250499984482e-07, 8.730858320013794e-07], ["orjson", 3.096652690001065e-07, 6.008548780009733e-07], ["msgpack", 3.735713579990261e-07, 6.712430439984019e-07], ["msgspec msgpack", 1.209437355000773e-07, 2.4524554299932786e-07], ["msgspec json", 1.5702481800053648e-07, 2.9431164100060416e-07]], "1k": [["ujson", 0.0006268990559983649, 0.0008841279000007489], ["orjson", 0.00022851538299983076, 0.0005686095599994587], ["msgpack", 0.000333242345999679, 0.0007984013619970938], ["msgspec msgpack", 7.986827880013152e-05, 0.0002904889190012909], ["msgspec json", 0.00012921423349962423, 0.00030142520899971713]]}
var results_valid = [["msgspec", 0.00014108686700001273, 0.0003501984610011277], ["pydantic", 0.015396889400017244, 0.022798635399885823], ["cattrs", 0.0025966005599912024, 0.0033668910000051256], ["mashumaro", 0.0009302718219987582, 0.0037224738400072964]]
buildPlot('#bench-1', results["1"], "Benchmark - 1 Object");
buildPlot('#bench-1k', results["1k"], "Benchmark - 1000 Objects");
buildPlot('#bench-1k-validate', results_valid, "Benchmark - 1000 Objects, With Validation");
</script></section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="examples/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Examples</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="api.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">API Docs</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, Jim Crist-Harif
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link " href="https://github.com/jcrist/msgspec" aria-label="GitHub"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
</svg></a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Benchmarks</a><ul>
<li><a class="reference internal" href="#benchmark-encoding-decoding">Benchmark - Encoding/Decoding</a><ul>
<li><a class="reference internal" href="#object">1 Object</a></li>
<li><a class="reference internal" href="#objects">1000 Objects</a></li>
</ul>
</li>
<li><a class="reference internal" href="#benchmark-schema-validation">Benchmark - Schema Validation</a></li>
<li><a class="reference internal" href="#benchmark-memory-usage">Benchmark - Memory Usage</a></li>
<li><a class="reference internal" href="#benchmark-structs">Benchmark - Structs</a></li>
<li><a class="reference internal" href="#benchmark-garbage-collection">Benchmark - Garbage Collection</a></li>
<li><a class="reference internal" href="#benchmark-library-size">Benchmark - Library Size</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=b3ba4146"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="_static/scripts/furo.js?v=32e29ea5"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=de5a9c30"></script>
    <script src="_static/design-tabs.js?v=36754332"></script>
    </body>
</html>